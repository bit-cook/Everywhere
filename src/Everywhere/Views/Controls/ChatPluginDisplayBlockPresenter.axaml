<ResourceDictionary
  xmlns="https://github.com/avaloniaui" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:at="clr-namespace:Everywhere.AttachedProperties" xmlns:md="clr-namespace:LiveMarkdown.Avalonia;assembly=LiveMarkdown.Avalonia"
  xmlns:plugins="clr-namespace:Everywhere.Chat.Plugins" xmlns:shadui="clr-namespace:ShadUI.Controls;assembly=ShadUI"
  xmlns:v="using:Everywhere.Views" xmlns:vc="clr-namespace:Everywhere.ValueConverters">
  <Design.PreviewWith>
    <v:ChatPluginDisplayBlockPresenter/>
  </Design.PreviewWith>

  <ControlTheme TargetType="v:ChatPluginDisplayBlockPresenter">
    <Setter Property="at:DataTemplatesAttach.DataTemplates">
      <DataTemplates>
        <DataTemplate DataType="plugins:ChatPluginTextDisplayBlock">
          <SelectableTextBlock
            Text="{Binding Text}"
            TextWrapping="Wrap"/>
        </DataTemplate>
        <DataTemplate DataType="plugins:ChatPluginMarkdownDisplayBlock">
          <md:MarkdownRenderer MarkdownBuilder="{Binding MarkdownBuilder}"/>
        </DataTemplate>
        <DataTemplate DataType="plugins:ChatPluginProgressDisplayBlock">
          <StackPanel Spacing="4">
            <TextBlock Text="{Binding HeaderKey^}"/>
            <ProgressBar
              IsIndeterminate="{Binding Progress, Converter={x:Static shadui:DoubleConverters.IsNaN}}"
              Maximum="1" Minimum="0"
              Value="{Binding Progress}"/>
          </StackPanel>
        </DataTemplate>
        <DataTemplate DataType="plugins:ChatPluginFileReferencesDisplayBlock">
          <StackPanel Spacing="4">
            <TextBlock>
              <Run Text="{I18N {x:Static LocaleKey.ChatPluginDisplayBlockPresenter_FileReferences_TotalCountRun_Text}}"/>
              <Run Text="{Binding TotalReferenceCount}"/>
            </TextBlock>
            <ItemsControl ItemsSource="{Binding References}">
              <ItemsControl.ItemTemplate>
                <DataTemplate DataType="plugins:ChatPluginFileReference">
                  <HyperlinkButton
                    Command="{Binding OpenFileLocation}"
                    Content="{Binding FullPath, Converter={x:Static vc:CommonConverters.FullPathToFileName}}"/>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
            <TextBlock
              IsVisible="{Binding HasMoreReferences}"
              Text="{I18N {x:Static LocaleKey.ChatPluginDisplayBlockPresenter_FileReferences_HasMoreReferencesTextBlock_Text}}"/>
          </StackPanel>
        </DataTemplate>
        <DataTemplate DataType="plugins:ChatPluginFileDifferenceDisplayBlock">
          <v:TextDifferenceSummaryView
            OriginalText="{Binding OriginalText}"
            TextDifference="{Binding Difference}"/>
        </DataTemplate>
        <DataTemplate DataType="plugins:ChatPluginFunctionContentDisplayBlock">
          <v:ChatPluginDisplayBlockPresenter Content="{Binding Content}"/>
        </DataTemplate>
      </DataTemplates>
    </Setter>
  </ControlTheme>
</ResourceDictionary>
